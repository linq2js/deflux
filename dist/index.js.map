{"version":3,"sources":["../index.js"],"names":["React","ComponentType","Symbol","StoreType","defaultPropMapper","x","defaultPayloadFactory","context","firstArg","dummyState","unsafeSetState","unsafeUpdate","isDispatcher","isAction","ignore","noop","undefined","subscriptionUniqueId","create","factory","describers","update","target","Error","store","initialState","reducers","subscriptions","computedProps","linkedProps","middlewares","stores","initMethods","currentState","updatingProps","recompute","prevState","descriptionContext","ownedProps","name","evaluator","computer","nextValue","apply","addReducer","reducer","push","addStore","addMiddleware","middleware","unshift","getState","updateLinkedProps","length","destProp","sourceProp","prevValue","setState","nextState","notify","addProperty","descriptor","map","options","action","dispatcher","Object","assign","payload","dispatch","getStore","selector","actionResult","then","pendingDispatchings","reduce","next","state","reducerResult","args","subscribe","subscriber","id","unsubscribed","notifiedSubscriptions","unsubscribedIndexes","i","subscription","splice","pop","updateProps","linkedProp","describingContext","objectType","forEach","describer","debouncedUpdateProps","debounce","subscribed","withReducer","withMiddleware","component","defaultComponent","hoc","propertyDescriptors","observables","hocs","addHoc","addObservable","observable","order","propName","sort","a","b","mapProps","mappedProps","propsChanged","prevProps","props","propertyDescritor","rawPropValue","propValue","concat","ComponentWrapper","Component","constructor","unsubscribes","handleChange","value","__lastValue","unsubscribe","shouldComponentUpdate","nextProps","nextMappedProps","shallowEqual","componentWillUnmount","render","createElement","withProp","evaluatorFactory","fromState","prop","fromStore","fromValue","fromObservable","fromPromise","defaultValue","shouldUpdate","loadingPayload","promisePropName","__payload","promise","result","error","fromProp","propNames","createPayloadFactory","withAction","addAction","payloadFactory","ownedPropName","arguments","withHoc","value1","value2","ignoreFuncs","Date","getTime","Array","isArray","value1Prop","value2Prop","value1Keys","keys","key","interval","callback","timer","clearTimeout","setTimeout","funcs","lastFunc","lastArgs","lastResult","wrapper","argSelectors","mappedArgs"],"mappings":"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","file":"index.js","sourcesContent":["import React from 'react';\r\n\r\nexport const ComponentType = Symbol('Component');\r\nexport const StoreType = Symbol('Store');\r\nconst defaultPropMapper = x => x;\r\nconst defaultPayloadFactory = (context, firstArg) => firstArg;\r\nconst dummyState = {};\r\nconst unsafeSetState = Symbol('SetState');\r\nconst unsafeUpdate = Symbol('Update');\r\nconst isDispatcher = Symbol('Dispatcher');\r\nconst isAction = Symbol('Action');\r\nconst ignore = Symbol('Ignore');\r\nconst noop = () => undefined;\r\nlet subscriptionUniqueId = 1;\r\n\r\nexport function create(factory, ...describers) {\r\n  return factory(describers);\r\n}\r\n\r\nexport function update(target, ...describers) {\r\n  if (unsafeUpdate in target) {\r\n    return target[unsafeUpdate](describers);\r\n  }\r\n  throw new Error('Target object does not support update');\r\n}\r\n\r\n/**\r\n * create a store\r\n */\r\nexport function store(initialState) {\r\n  return function(describers) {\r\n    const reducers = [];\r\n    const subscriptions = [];\r\n    const computedProps = [];\r\n    const linkedProps = [];\r\n    const middlewares = [];\r\n    const stores = [];\r\n    const initMethods = {};\r\n\r\n    let currentState = initialState;\r\n    let updatingProps = false;\r\n    let store;\r\n\r\n    function recompute() {\r\n      const prevState = currentState;\r\n      const descriptionContext = {\r\n        ownedProps: currentState\r\n      };\r\n      for (let [name, evaluator, computer] of computedProps) {\r\n        const nextValue = computer.apply(null, evaluator(descriptionContext));\r\n\r\n        if (nextValue !== currentState[name]) {\r\n          if (currentState === prevState) {\r\n            currentState = {\r\n              ...currentState\r\n            };\r\n          }\r\n\r\n          currentState[name] = nextValue;\r\n        }\r\n      }\r\n    }\r\n\r\n    function addReducer(reducer) {\r\n      reducers.push(reducer);\r\n    }\r\n\r\n    function addStore(store) {\r\n      stores.push(store);\r\n    }\r\n\r\n    function addMiddleware(middleware) {\r\n      middlewares.unshift(middleware);\r\n    }\r\n\r\n    function getState() {\r\n      return currentState;\r\n    }\r\n\r\n    function updateLinkedProps() {\r\n      if (linkedProps.length) {\r\n        if (updatingProps) return;\r\n        try {\r\n          for (let [destProp, store, sourceProp] of linkedProps) {\r\n            const nextValue = currentState[destProp];\r\n            const prevValue = !sourceProp\r\n              ? store.getState()\r\n              : store.getState()[sourceProp];\r\n            // update source store\r\n            if (nextValue !== prevValue) {\r\n              if (!sourceProp) {\r\n                store[unsafeSetState](nextValue);\r\n              } else {\r\n                store[unsafeSetState]({\r\n                  ...store.getState(),\r\n                  [sourceProp]: nextValue\r\n                });\r\n              }\r\n            }\r\n          }\r\n        } finally {\r\n          updatingProps = false;\r\n        }\r\n      }\r\n    }\r\n\r\n    function setState(nextState) {\r\n      if (nextState === currentState) return;\r\n      currentState = nextState;\r\n      updateLinkedProps();\r\n      // re-compute\r\n      recompute();\r\n\r\n      notify();\r\n    }\r\n\r\n    function addProperty(name, descriptor, map, options) {\r\n      if (typeof map !== 'function' && map !== false) {\r\n        // create linked prop\r\n        if (!stores.length) {\r\n          throw new Error('At least store required to create linked prop');\r\n        } else if (stores.length > 1) {\r\n          throw new Error('Linked prop requires only a store');\r\n        }\r\n        linkedProps.push([name, stores[0], map, options]);\r\n        stores.length = 0;\r\n      } else if (descriptor[isAction]) {\r\n        const action = descriptor;\r\n        const dispatcher = Object.assign(\r\n          payload => {\r\n            store.dispatch(action, payload);\r\n          },\r\n          {\r\n            [StoreType]: getStore\r\n          }\r\n        );\r\n\r\n        if (store) {\r\n          if (name in store) {\r\n            // overwrite existing method is not allowed\r\n          } else {\r\n            store[name] = dispatcher;\r\n          }\r\n        } else {\r\n          initMethods[name] = dispatcher;\r\n        }\r\n      } else {\r\n        computedProps.push([name, descriptor, selector(map), options]);\r\n      }\r\n    }\r\n\r\n    function dispatch(action, payload) {\r\n      let actionResult = action(payload);\r\n      if (typeof actionResult === 'function') {\r\n        actionResult = actionResult(currentState);\r\n        if (typeof actionResult === 'function') {\r\n          actionResult = actionResult(dispatch, getState);\r\n          return actionResult;\r\n        } else {\r\n          // new state\r\n          if (actionResult && typeof actionResult.then === 'function') {\r\n            return actionResult.then(setState);\r\n          } else {\r\n            setState(actionResult);\r\n          }\r\n        }\r\n      } else {\r\n        // action creator result\r\n        // call middlewares and reducers\r\n        const pendingDispatchings = [];\r\n        const prevState = currentState;\r\n        currentState = middlewares.reduce(\r\n          (next, middleware) => {\r\n            return function(action, payload) {\r\n              return middleware(store)(next)(action, payload);\r\n            };\r\n          },\r\n          (action, payload) => {\r\n            return reducers.reduce((state, reducer) => {\r\n              const reducerResult = reducer(state, action, payload);\r\n              // support lazy dispatching inside reducer\r\n              if (typeof reducerResult === 'function') {\r\n                reducerResult((...args) => pendingDispatchings.push(args));\r\n                return state;\r\n              }\r\n              return reducerResult;\r\n            }, currentState);\r\n          }\r\n        )(action, actionResult);\r\n\r\n        if (currentState !== prevState) {\r\n          updateLinkedProps();\r\n          recompute();\r\n          notify();\r\n        }\r\n\r\n        if (pendingDispatchings.length) {\r\n          for (let [action, payload] of pendingDispatchings) {\r\n            dispatch(action, payload);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    function getStore() {\r\n      return store;\r\n    }\r\n\r\n    function subscribe(subscriber) {\r\n      if (!subscriber.id) {\r\n        subscriber.id = subscriptionUniqueId++;\r\n      }\r\n      subscriptions.push(subscriber);\r\n\r\n      return function() {\r\n        subscriber.unsubscribed = true;\r\n      };\r\n    }\r\n\r\n    function notify(notifiedSubscriptions = {}) {\r\n      const unsubscribedIndexes = [];\r\n      for (let i = 0; i < subscriptions.length; i++) {\r\n        const subscription = subscriptions[i];\r\n        // do nothing if subscription is unsubscribed\r\n        if (subscription.unsubscribed) {\r\n          unsubscribedIndexes.push(i);\r\n        } else if (subscription.id in notifiedSubscriptions) {\r\n          // do nothing if subscription is already notified\r\n        } else {\r\n          // mark subscription is notified\r\n          notifiedSubscriptions[subscription.id] = true;\r\n          subscription(currentState);\r\n        }\r\n      }\r\n\r\n      // remove unsubscribed subscriptions\r\n      while (unsubscribedIndexes.length) {\r\n        subscriptions.splice(unsubscribedIndexes.pop(), 1);\r\n      }\r\n    }\r\n\r\n    const updateProps = () => {\r\n      if (updatingProps) return;\r\n\r\n      updatingProps = true;\r\n      try {\r\n        const prevState = currentState;\r\n        for (let linkedProp of linkedProps) {\r\n          const [destProp, store, sourceProp] = linkedProp;\r\n          const nextValue = !sourceProp\r\n            ? store.getState()\r\n            : store.getState()[sourceProp];\r\n\r\n          if (currentState[destProp] !== nextValue) {\r\n            if (currentState === prevState) {\r\n              currentState = {\r\n                ...currentState\r\n              };\r\n            }\r\n\r\n            currentState[destProp] = nextValue;\r\n          }\r\n        }\r\n\r\n        if (currentState !== prevState) {\r\n          recompute();\r\n          notify();\r\n        }\r\n      } finally {\r\n        updatingProps = false;\r\n      }\r\n    };\r\n\r\n    function update(describers) {\r\n      const describingContext = {\r\n        objectType: StoreType,\r\n        getStore,\r\n        addReducer,\r\n        addStore,\r\n        addMiddleware,\r\n        addProperty\r\n      };\r\n\r\n      describers.forEach(describer => describer(describingContext));\r\n\r\n      const debouncedUpdateProps = debounce(0, updateProps);\r\n\r\n      if (linkedProps.length) {\r\n        if (currentState === null || currentState === undefined) {\r\n          currentState = {};\r\n        }\r\n\r\n        linkedProps.forEach(linkedProp => {\r\n          if (linkedProp.subscribed) return;\r\n          linkedProp.subscribed = true;\r\n          linkedProp[1].subscribe(debouncedUpdateProps);\r\n        });\r\n\r\n        updateProps();\r\n      }\r\n\r\n      if (computedProps.length) {\r\n        recompute();\r\n      }\r\n    }\r\n\r\n    update(describers);\r\n\r\n    return (store = {\r\n      ...initMethods,\r\n      getState,\r\n      subscribe,\r\n      dispatch,\r\n      [unsafeUpdate]: update,\r\n      [unsafeSetState]: setState\r\n    });\r\n  };\r\n}\r\n\r\n/**\r\n * add reducer to store\r\n */\r\nexport function withReducer(...reducers) {\r\n  return function({ addReducer }) {\r\n    reducers.forEach(addReducer);\r\n  };\r\n}\r\n\r\n/**\r\n * add middleware to store\r\n */\r\nexport function withMiddleware(...middlewares) {\r\n  return function({ addMiddleware }) {\r\n    middlewares.forEach(addMiddleware);\r\n  };\r\n}\r\n\r\n/**\r\n * create a component/hoc\r\n */\r\nexport function component(defaultComponent) {\r\n  return function(describers) {\r\n    const hoc = function(component) {\r\n      const propertyDescriptors = [];\r\n      const stores = [];\r\n      const observables = [];\r\n      const hocs = [];\r\n      const describingContext = {\r\n        objectType: ComponentType,\r\n        component,\r\n        addStore,\r\n        addProperty,\r\n        addHoc,\r\n        addObservable\r\n      };\r\n      describers.forEach(describer => describer(describingContext));\r\n\r\n      function addStore(store) {\r\n        stores.push(store);\r\n      }\r\n\r\n      function addObservable(observable) {\r\n        observables.push(observable);\r\n      }\r\n\r\n      function addHoc(hoc) {\r\n        hocs.push(hoc);\r\n      }\r\n\r\n      function addProperty(\r\n        name,\r\n        descriptor,\r\n        map = defaultPropMapper,\r\n        options,\r\n        order = 0\r\n      ) {\r\n        if (typeof map === 'string') {\r\n          const propName = map;\r\n          map = x => x[propName];\r\n        }\r\n\r\n        propertyDescriptors.push([name, descriptor, map, options, order]);\r\n        // re-sort descriptors\r\n        propertyDescriptors.sort((a, b) => a[4] - b[4]);\r\n      }\r\n\r\n      function mapProps(component, ownedProps) {\r\n        const mappedProps = {};\r\n        const descriptionContext = {\r\n          component,\r\n          ownedProps,\r\n          mappedProps,\r\n          // detech prop changed\r\n          propsChanged:\r\n            component.prevProps && component.prevProps !== component.props\r\n        };\r\n\r\n        component.prevProps = component.props;\r\n\r\n        for (let [propName, propertyDescritor, map] of propertyDescriptors) {\r\n          const rawPropValue = propertyDescritor(\r\n            descriptionContext,\r\n            propName,\r\n            map\r\n          );\r\n          if (rawPropValue === ignore) continue;\r\n          let propValue =\r\n            map !== false\r\n              ? map.apply(null, rawPropValue.concat([descriptionContext]))\r\n              : rawPropValue;\r\n\r\n          if (typeof propValue === 'function' && !propValue[isDispatcher]) {\r\n            propValue = propValue(descriptionContext);\r\n          }\r\n\r\n          if (propName === '*') {\r\n            Object.assign(mappedProps, propValue);\r\n          } else {\r\n            mappedProps[propName] = propValue;\r\n          }\r\n        }\r\n\r\n        return mappedProps;\r\n      }\r\n\r\n      return hocs.reduce(\r\n        (component, hoc) => hoc(component),\r\n        class ComponentWrapper extends React.Component {\r\n          constructor(props) {\r\n            super(props);\r\n            // perform first mapping\r\n            // collect all dependency stores if any\r\n            this.mappedProps = mapProps(this, props);\r\n\r\n            const unsubscribes = [];\r\n\r\n            const handleChange = () => this.setState(dummyState);\r\n\r\n            unsubscribes.push(\r\n              ...stores.map(store => store.subscribe(handleChange))\r\n            );\r\n\r\n            unsubscribes.push(\r\n              ...observables.map(observable =>\r\n                observable.subscribe(value => {\r\n                  observable.__lastValue = value;\r\n                  handleChange();\r\n                })\r\n              )\r\n            );\r\n\r\n            this.unsubscribe = () =>\r\n              unsubscribes.forEach(unsubscribe => {\r\n                if (\r\n                  unsubscribe &&\r\n                  typeof unsubscribe.unsubscribe === 'function'\r\n                ) {\r\n                  unsubscribe.unsubscribe();\r\n                } else if (typeof unsubscribe === 'function') {\r\n                  unsubscribe();\r\n                }\r\n              });\r\n          }\r\n\r\n          shouldComponentUpdate(nextProps) {\r\n            const nextMappedProps = mapProps(this, nextProps);\r\n            if (shallowEqual(nextMappedProps, this.mappedProps, true))\r\n              return false;\r\n            this.mappedProps = nextMappedProps;\r\n            return true;\r\n          }\r\n\r\n          componentWillUnmount() {\r\n            this.unsubscribe();\r\n          }\r\n\r\n          render() {\r\n            return React.createElement(component, this.mappedProps);\r\n          }\r\n        }\r\n      );\r\n    };\r\n\r\n    if (defaultComponent) {\r\n      return hoc(defaultComponent);\r\n    }\r\n    return hoc;\r\n  };\r\n}\r\n\r\n/**\r\n * describe prop for component\r\n */\r\nexport function withProp(name, evaluatorFactory, map, options) {\r\n  return function(describingContext) {\r\n    const { addProperty } = describingContext;\r\n    const evaluator = evaluatorFactory(describingContext);\r\n\r\n    addProperty(\r\n      name,\r\n      function(descriptionContext) {\r\n        return evaluator(descriptionContext);\r\n      },\r\n      map,\r\n      options\r\n    );\r\n  };\r\n}\r\n\r\n/**\r\n * get value from component state\r\n */\r\nexport function fromState(...props) {\r\n  return function({ objectType }) {\r\n    if (objectType !== ComponentType) {\r\n      throw new Error('fromState can be used with component()');\r\n    }\r\n    return function(descriptionContext) {\r\n      const state = descriptionContext.component.state || {};\r\n      return props.map(prop => state[prop]);\r\n    };\r\n  };\r\n}\r\n\r\n// get value from store\r\nexport function fromStore(...stores) {\r\n  return function({ addStore }) {\r\n    stores.forEach(store => addStore(store));\r\n\r\n    return function() {\r\n      return stores.map(store => store.getState());\r\n    };\r\n  };\r\n}\r\n\r\nexport function fromValue(factory) {\r\n  return function() {\r\n    return function(descriptionContext) {\r\n      return [factory(descriptionContext)];\r\n    };\r\n  };\r\n}\r\n\r\nexport function fromObservable(...observables) {\r\n  return function({ addObservable }) {\r\n    observables.forEach(observable => addObservable(observable));\r\n    return function() {\r\n      return observables.map(observable => observable.__lastValue);\r\n    };\r\n  };\r\n}\r\n\r\nexport function fromPromise(\r\n  factory,\r\n  { defaultValue, shouldUpdate = noop } = {}\r\n) {\r\n  const loadingPayload = [defaultValue, 'loading'];\r\n  return function({ objectType }) {\r\n    if (objectType !== ComponentType) {\r\n      throw new Error('fromState can be used with component()');\r\n    }\r\n    return function(descriptionContext, propName) {\r\n      const { component } = descriptionContext;\r\n      const promisePropName = `__${propName}Promise`;\r\n\r\n      if (component[promisePropName]) {\r\n        if (shouldUpdate(descriptionContext, component[promisePropName])) {\r\n        } else {\r\n          return component[promisePropName].__payload;\r\n        }\r\n      }\r\n\r\n      const promise = factory(descriptionContext);\r\n\r\n      if (!promise) {\r\n        return [defaultValue, ''];\r\n      }\r\n\r\n      promise.__payload = loadingPayload;\r\n\r\n      component[promisePropName] = promise;\r\n\r\n      promise.then(\r\n        // handle success\r\n        result => {\r\n          if (component[promisePropName] === promise) {\r\n            component[promisePropName].__payload = [result, 'success'];\r\n            // reload\r\n            component.setState(dummyState);\r\n          }\r\n        },\r\n        // handle failure\r\n        error => {\r\n          if (component[promisePropName] === promise) {\r\n            component[promisePropName].__payload = [\r\n              defaultValue,\r\n              'failure',\r\n              error\r\n            ];\r\n            // reload\r\n            component.setState(dummyState);\r\n          }\r\n        }\r\n      );\r\n\r\n      return promise.__payload;\r\n    };\r\n  };\r\n}\r\n\r\n/**\r\n * get value from props\r\n */\r\nexport function fromProp(...propNames) {\r\n  return function() {\r\n    return function({ ownedProps }) {\r\n      return propNames.map(propName => ownedProps[propName]);\r\n    };\r\n  };\r\n}\r\n\r\nfunction createPayloadFactory() {\r\n  return undefined;\r\n}\r\n\r\n/**\r\n * add wired action to component props\r\n */\r\nexport function withAction(name, store, ...args) {\r\n  return function(describingContext) {\r\n    const { objectType, addProperty } = describingContext;\r\n    if (objectType === StoreType) {\r\n      return addProperty(\r\n        name,\r\n        Object.assign(store, { [isAction]: true }),\r\n        false\r\n      );\r\n    } else {\r\n      // is component type\r\n      let getStore;\r\n      // withAction('name', store.action, payloadFactory)\r\n      if (typeof store === 'function') {\r\n        const action = store;\r\n        if (action[StoreType]) {\r\n          args.unshift(action);\r\n          getStore = action[StoreType];\r\n        } else {\r\n          action[isDispatcher] = true;\r\n          addProperty(\r\n            name,\r\n            function(descriptionContext) {\r\n              return action;\r\n            },\r\n            false\r\n          );\r\n          return;\r\n        }\r\n      } else {\r\n        getStore = () => {\r\n          return store;\r\n        };\r\n        // withAction('name', store, action, payloadFactory)\r\n      }\r\n      return addAction(describingContext, name, getStore, ...args);\r\n    }\r\n  };\r\n}\r\n\r\nfunction addAction(\r\n  describingContext,\r\n  name,\r\n  getStore,\r\n  action,\r\n  payloadFactory = defaultPayloadFactory\r\n) {\r\n  const { addProperty } = describingContext;\r\n\r\n  if (typeof payloadFactory === 'string') {\r\n    const ownedPropName = payloadFactory;\r\n    payloadFactory = () => ({ ownedProps }) => ownedProps[ownedPropName];\r\n  } else if (typeof payloadFactory !== 'function') {\r\n    payloadFactory = createPayloadFactory(payloadFactory, describingContext);\r\n  }\r\n\r\n  addProperty(\r\n    name,\r\n    function(descriptionContext) {\r\n      return Object.assign(\r\n        function() {\r\n          let payload = payloadFactory.apply(null, arguments);\r\n\r\n          if (typeof payload === 'function') {\r\n            payload = payload(descriptionContext, action);\r\n          }\r\n\r\n          // support redux action\r\n          if (!action) {\r\n            return getStore().dispatch(payload);\r\n          }\r\n          return getStore().dispatch(action, payload);\r\n        },\r\n        {\r\n          [isDispatcher]: true\r\n        }\r\n      );\r\n    },\r\n    false\r\n  );\r\n}\r\n\r\nexport function withHoc(...hocs) {\r\n  return function({ addHoc }) {\r\n    hocs.forEach(addHoc);\r\n  };\r\n}\r\n\r\nexport function shallowEqual(value1, value2, ignoreFuncs) {\r\n  if (value1 === value2) return true;\r\n  // compare date\r\n  if (value1 instanceof Date && value2 instanceof Date) {\r\n    return value1.getTime() === value2.getTime();\r\n  }\r\n  if (value1 && value2) {\r\n    if (Array.isArray(value1)) {\r\n      const length = value1.length;\r\n      if (length !== value2.length) return false;\r\n      for (let i = 0; i < length; i++) {\r\n        const value1Prop = value1[i];\r\n        const value2Prop = value2[i];\r\n        if (\r\n          ignoreFuncs &&\r\n          typeof value1Prop === 'function' &&\r\n          typeof value2Prop === 'function'\r\n        )\r\n          continue;\r\n        if (value1Prop !== value2Prop) return false;\r\n      }\r\n      return true;\r\n    }\r\n    const value1Keys = Object.keys(value1);\r\n    if (value1Keys.length !== Object.keys(value2).length) return false;\r\n    for (let key of value1Keys) {\r\n      const value1Prop = value1[key];\r\n      const value2Prop = value2[key];\r\n      if (\r\n        ignoreFuncs &&\r\n        typeof value1Prop === 'function' &&\r\n        typeof value2Prop === 'function'\r\n      )\r\n        continue;\r\n      if (value1Prop !== value2Prop) return false;\r\n    }\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function debounce(interval, callback) {\r\n  let timer;\r\n\r\n  return function() {\r\n    const args = arguments;\r\n    clearTimeout(timer);\r\n    timer = setTimeout(() => callback.apply(null, args), interval);\r\n  };\r\n}\r\n\r\nexport function selector(...funcs) {\r\n  const lastFunc = funcs.pop();\r\n  let lastArgs, lastResult;\r\n  const wrapper = function(...args) {\r\n    if (shallowEqual(lastArgs, args)) {\r\n      return lastResult;\r\n    }\r\n    lastArgs = args;\r\n    return (lastResult = lastFunc.apply(null, args));\r\n  };\r\n\r\n  if (!funcs.length) {\r\n    return wrapper;\r\n  }\r\n\r\n  const argSelectors = funcs.map(x => selector(x));\r\n  return function(...args) {\r\n    const mappedArgs = argSelectors.map(x => x.apply(null, args));\r\n    return wrapper.apply(null, mappedArgs);\r\n  };\r\n}\r\n"]}